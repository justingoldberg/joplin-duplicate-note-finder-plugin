(()=>{"use strict";var n={156(n,e,t){var i=this&&this.__awaiter||function(n,e,t,i){return new(t||(t=Promise))(function(o,r){function a(n){try{l(i.next(n))}catch(n){r(n)}}function s(n){try{l(i.throw(n))}catch(n){r(n)}}function l(n){var e;n.done?o(n.value):(e=n.value,e instanceof t?e:new t(function(n){n(e)})).then(a,s)}l((i=i.apply(n,e||[])).next())})},o=this&&this.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(e,"__esModule",{value:!0});const r=o(t(860)),a=t(530);function s(n){return n.toLowerCase().replace(/[#*_`\[\]()>~\-]/g," ").split(/\s+/).filter(n=>n.length>2)}function l(n,e){if(0===n.length&&0===e.length)return 1;if(0===n.length||0===e.length)return 0;const t=new Set(n),i=new Set(e);let o=0;t.forEach(n=>{i.has(n)&&o++});const r=t.size+i.size-o;return o/r}r.default.plugins.register({onStart:function(){return i(this,void 0,void 0,function*(){yield r.default.commands.register({name:"findDuplicateNotes",label:"Find Duplicate Notes",iconName:"fas fa-copy",execute:()=>i(this,void 0,void 0,function*(){yield function(){return i(this,void 0,void 0,function*(){yield r.default.views.panels.setHtml(n,'<!DOCTYPE html>\n<html lang="en">\n<head>\n<meta charset="UTF-8"/>\n<meta name="viewport" content="width=device-width, initial-scale=1.0"/>\n<style>\n  * { box-sizing: border-box; margin: 0; padding: 0; }\n\n  body {\n    font-family: -apple-system, BlinkMacSystemFont, \'Segoe UI\', sans-serif;\n    background: var(--joplin-background-color, #1e1e2e);\n    color: var(--joplin-color, #cdd6f4);\n    padding: 0;\n    height: 100vh;\n    display: flex;\n    flex-direction: column;\n  }\n\n  header {\n    background: var(--joplin-background-color-3, #181825);\n    padding: 14px 18px;\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n    border-bottom: 1px solid var(--joplin-divider-color, #313244);\n    flex-shrink: 0;\n  }\n\n  header h1 {\n    font-size: 16px;\n    font-weight: 600;\n    display: flex;\n    align-items: center;\n    gap: 8px;\n  }\n\n  #closeBtn {\n    background: none;\n    border: none;\n    color: var(--joplin-color, #cdd6f4);\n    font-size: 18px;\n    cursor: pointer;\n    padding: 4px 8px;\n    border-radius: 4px;\n    line-height: 1;\n  }\n  #closeBtn:hover { background: rgba(255,255,255,0.08); }\n\n  .controls {\n    padding: 14px 18px;\n    background: var(--joplin-background-color-2, #1e1e2e);\n    border-bottom: 1px solid var(--joplin-divider-color, #313244);\n    flex-shrink: 0;\n  }\n\n  .slider-row {\n    display: flex;\n    align-items: center;\n    gap: 12px;\n    margin-bottom: 10px;\n  }\n\n  .slider-row label {\n    font-size: 13px;\n    color: var(--joplin-color-faded, #a6adc8);\n    white-space: nowrap;\n  }\n\n  #thresholdSlider {\n    flex: 1;\n    -webkit-appearance: none;\n    height: 4px;\n    border-radius: 2px;\n    background: linear-gradient(\n      to right,\n      #89b4fa 0%,\n      #89b4fa var(--val, 59%),\n      #313244 var(--val, 59%),\n      #313244 100%\n    );\n    outline: none;\n    cursor: pointer;\n  }\n\n  #thresholdSlider::-webkit-slider-thumb {\n    -webkit-appearance: none;\n    width: 16px;\n    height: 16px;\n    border-radius: 50%;\n    background: #89b4fa;\n    cursor: pointer;\n    border: 2px solid #1e1e2e;\n    box-shadow: 0 1px 4px rgba(0,0,0,0.4);\n  }\n\n  #thresholdValue {\n    font-size: 14px;\n    font-weight: 700;\n    color: #89b4fa;\n    min-width: 36px;\n    text-align: right;\n  }\n\n  .marks {\n    display: flex;\n    justify-content: space-between;\n    font-size: 10px;\n    color: var(--joplin-color-faded, #585b70);\n    padding: 0 2px;\n    margin-top: -6px;\n    margin-bottom: 10px;\n  }\n\n  #scanBtn {\n    background: #89b4fa;\n    color: #1e1e2e;\n    border: none;\n    padding: 8px 20px;\n    border-radius: 6px;\n    font-size: 13px;\n    font-weight: 600;\n    cursor: pointer;\n    transition: background 0.15s;\n  }\n  #scanBtn:hover { background: #74c7ec; }\n  #scanBtn:disabled { background: #45475a; color: #6c7086; cursor: default; }\n\n  #status {\n    font-size: 12px;\n    color: var(--joplin-color-faded, #a6adc8);\n    margin-top: 8px;\n    min-height: 18px;\n  }\n\n  #results {\n    flex: 1;\n    overflow-y: auto;\n    padding: 14px 18px;\n  }\n\n  .empty-state {\n    text-align: center;\n    padding: 60px 20px;\n    color: var(--joplin-color-faded, #585b70);\n    font-size: 14px;\n  }\n  .empty-state .icon { font-size: 36px; margin-bottom: 12px; }\n\n  .pair-card {\n    background: var(--joplin-background-color-3, #181825);\n    border: 1px solid var(--joplin-divider-color, #313244);\n    border-radius: 8px;\n    margin-bottom: 10px;\n    overflow: hidden;\n  }\n\n  .pair-header {\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n    padding: 10px 14px;\n    border-bottom: 1px solid var(--joplin-divider-color, #313244);\n    background: rgba(137,180,250,0.06);\n  }\n\n  .similarity-badge {\n    font-size: 11px;\n    font-weight: 700;\n    padding: 3px 8px;\n    border-radius: 12px;\n    letter-spacing: 0.5px;\n  }\n  .sim-high { background: rgba(243,139,168,0.2); color: #f38ba8; }\n  .sim-mid  { background: rgba(249,226,175,0.2); color: #f9e2af; }\n  .sim-low  { background: rgba(166,227,161,0.2); color: #a6e3a1; }\n\n  .notes-row {\n    display: grid;\n    grid-template-columns: 1fr 1fr;\n    gap: 0;\n  }\n\n  .note-cell {\n    padding: 10px 14px;\n    cursor: pointer;\n    transition: background 0.12s;\n    border-right: 1px solid var(--joplin-divider-color, #313244);\n  }\n  .note-cell:last-child { border-right: none; }\n  .note-cell:hover { background: rgba(137,180,250,0.08); }\n\n  .note-title {\n    font-size: 13px;\n    font-weight: 600;\n    margin-bottom: 4px;\n    white-space: nowrap;\n    overflow: hidden;\n    text-overflow: ellipsis;\n    color: var(--joplin-color, #cdd6f4);\n  }\n\n  .note-preview {\n    font-size: 11px;\n    color: var(--joplin-color-faded, #7f849c);\n    display: -webkit-box;\n    -webkit-line-clamp: 2;\n    -webkit-box-orient: vertical;\n    overflow: hidden;\n    line-height: 1.5;\n  }\n\n  .open-hint {\n    font-size: 10px;\n    color: #89b4fa;\n    margin-top: 4px;\n  }\n</style>\n</head>\n<body>\n\n<header>\n  <h1>üîç Duplicate Note Finder</h1>\n  <button id="closeBtn" title="Close">‚úï</button>\n</header>\n\n<div class="controls">\n  <div class="slider-row">\n    <label>Similarity threshold:</label>\n    <input type="range" id="thresholdSlider" min="30" max="75" value="50" step="1"/>\n    <span id="thresholdValue">50%</span>\n  </div>\n  <div class="marks">\n    <span>30% (loose)</span>\n    <span>50% (default)</span>\n    <span>75% (strict)</span>\n  </div>\n  <button id="scanBtn">Scan All Notes</button>\n  <div id="status">Ready ‚Äî press Scan to begin.</div>\n</div>\n\n<div id="results">\n  <div class="empty-state">\n    <div class="icon">üìã</div>\n    <div>Adjust the slider, then press <strong>Scan All Notes</strong>.</div>\n  </div>\n</div>\n\n<script>\n  const slider = document.getElementById(\'thresholdSlider\');\n  const valueLabel = document.getElementById(\'thresholdValue\');\n  const scanBtn = document.getElementById(\'scanBtn\');\n  const statusEl = document.getElementById(\'status\');\n  const resultsEl = document.getElementById(\'results\');\n  const closeBtn = document.getElementById(\'closeBtn\');\n\n  function updateSliderTrack() {\n    const min = 30, max = 75;\n    const pct = ((slider.value - min) / (max - min)) * 100;\n    slider.style.setProperty(\'--val\', pct + \'%\');\n    valueLabel.textContent = slider.value + \'%\';\n  }\n\n  slider.addEventListener(\'input\', updateSliderTrack);\n  updateSliderTrack();\n\n  closeBtn.addEventListener(\'click\', () => {\n    webviewApi.postMessage({ type: \'close\' });\n  });\n\n  scanBtn.addEventListener(\'click\', async () => {\n    scanBtn.disabled = true;\n    scanBtn.textContent = \'Scanning‚Ä¶\';\n    statusEl.textContent = \'Fetching notes and comparing ‚Äî this may take a moment‚Ä¶\';\n    resultsEl.innerHTML = \'\';\n\n    const threshold = parseInt(slider.value, 10);\n\n    try {\n      const response = await webviewApi.postMessage({ type: \'scan\', threshold });\n      renderResults(response.duplicates, threshold);\n    } catch (err) {\n      statusEl.textContent = \'Error: \' + err.message;\n    } finally {\n      scanBtn.disabled = false;\n      scanBtn.textContent = \'Scan All Notes\';\n    }\n  });\n\n  function simClass(sim) {\n    if (sim >= 70) return \'sim-high\';\n    if (sim >= 50) return \'sim-mid\';\n    return \'sim-low\';\n  }\n\n  function renderResults(duplicates, threshold) {\n    if (!duplicates || duplicates.length === 0) {\n      statusEl.textContent = \'No duplicates found at \' + threshold + \'% threshold.\';\n      resultsEl.innerHTML = `\n        <div class="empty-state">\n          <div class="icon">‚úÖ</div>\n          <div>No duplicate notes found at <strong>${threshold}%</strong> similarity.</div>\n        </div>`;\n      return;\n    }\n\n    statusEl.textContent = `Found ${duplicates.length} duplicate pair${duplicates.length !== 1 ? \'s\' : \'\'} at ‚â•${threshold}% similarity.`;\n\n    const html = duplicates.map(pair => {\n      const cls = simClass(pair.similarity);\n      return `\n      <div class="pair-card">\n        <div class="pair-header">\n          <span style="font-size:12px;color:var(--joplin-color-faded,#a6adc8)">Similar pair</span>\n          <span class="similarity-badge ${cls}">${pair.similarity}% similar</span>\n        </div>\n        <div class="notes-row">\n          <div class="note-cell" data-id="${pair.a.id}">\n            <div class="note-title" title="${escapeHtml(pair.a.title)}">${escapeHtml(pair.a.title)}</div>\n            <div class="note-preview">${escapeHtml(pair.a.preview)}</div>\n            <div class="open-hint">‚Üó Click to open</div>\n          </div>\n          <div class="note-cell" data-id="${pair.b.id}">\n            <div class="note-title" title="${escapeHtml(pair.b.title)}">${escapeHtml(pair.b.title)}</div>\n            <div class="note-preview">${escapeHtml(pair.b.preview)}</div>\n            <div class="open-hint">‚Üó Click to open</div>\n          </div>\n        </div>\n      </div>`;\n    }).join(\'\');\n\n    resultsEl.innerHTML = html;\n\n    // Attach click handlers to open notes\n    resultsEl.querySelectorAll(\'.note-cell\').forEach(cell => {\n      cell.addEventListener(\'click\', () => {\n        webviewApi.postMessage({ type: \'openNote\', noteId: cell.dataset.id });\n      });\n    });\n  }\n\n  function escapeHtml(str) {\n    return String(str)\n      .replace(/&/g, \'&amp;\')\n      .replace(/</g, \'&lt;\')\n      .replace(/>/g, \'&gt;\')\n      .replace(/"/g, \'&quot;\');\n  }\n<\/script>\n</body>\n</html>'),yield r.default.views.panels.show(n)})}()})}),yield r.default.views.menuItems.create("menuItemFindDuplicates","findDuplicateNotes",a.MenuItemLocation.Tools,{accelerator:"CmdOrCtrl+Shift+D"});const n=yield r.default.views.panels.create("duplicateFinderPanel");yield r.default.views.panels.setHtml(n,"<p>Loading...</p>"),yield r.default.views.panels.hide(n),yield r.default.views.panels.onMessage(n,e=>i(this,void 0,void 0,function*(){if("scan"===e.type){const n=e.threshold/100,t=yield function(n){return i(this,void 0,void 0,function*(){const e=yield function(){return i(this,void 0,void 0,function*(){const n=[];let e=1;for(;;){const t=yield r.default.data.get(["notes"],{fields:["id","title","body"],limit:50,page:e});for(const e of t.items){const t=e.body||"";n.push({id:e.id,title:e.title||"(Untitled)",tokens:s(t),bodyPreview:t.slice(0,200).replace(/\n/g," ")})}if(!t.has_more)break;e++}return n})}(),t=[];for(let i=0;i<e.length;i++)for(let o=i+1;o<e.length;o++){const r=l(e[i].tokens,e[o].tokens);r>=n&&t.push({a:{id:e[i].id,title:e[i].title,preview:e[i].bodyPreview},b:{id:e[o].id,title:e[o].title,preview:e[o].bodyPreview},similarity:Math.round(100*r)})}return t.sort((n,e)=>e.similarity-n.similarity),t})}(n);return{type:"results",duplicates:t}}"openNote"===e.type&&(yield r.default.commands.execute("openNote",e.noteId)),"close"===e.type&&(yield r.default.views.panels.hide(n))}))})}})},860(n){n.exports=require("api")},530(n){n.exports=require("api/types")}},e={},t=function t(i){var o=e[i];if(void 0!==o)return o.exports;var r=e[i]={exports:{}};return n[i].call(r.exports,r,r.exports,t),r.exports}(156);exports.exports=t})();